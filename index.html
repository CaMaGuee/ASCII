<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>휴가 계산기</title>
<style>
/* ===== 기본 ===== */
html, body { overflow: auto; }
html::-webkit-scrollbar { width:0px; background:transparent; }
html { scrollbar-width:none; -ms-overflow-style:none; }
body {
  font-family:"Noto Sans KR", sans-serif;
  margin:0 auto;
  background:#f0f2f5;
  color:#111;
}

/* ===== 버튼 ===== */
button { padding:8px 14px; border-radius:5px; border:none; cursor:pointer; font-weight:600; }
button.primary { margin-top:10px; background:linear-gradient(180deg,#0055ffa1,#0055ff); box-shadow:0 4px 12px rgba(0, 47, 255, 0.4); color:#fff; }
button.primary:hover { background:linear-gradient(180deg,#0055ff80,#0055ffcb); box-shadow:0 4px 12px rgba(2,6,23,0.04); color:#fff; }
button.small { background:#f1f3f6; color:#202124; }

/* ===== 캘린더 ===== */
#calendar { margin-top:14px; border-radius:14px; overflow:hidden; }
h2.fc-toolbar-title { font-size: 17px !important; }
.fc-toolbar-chunk .fc-button { font-size: 13px !important; }
.fc .fc-daygrid-day-number { font-size:13px; font-weight:600; padding:6px; color:rgb(87,0,0); }
.fc .fc-daygrid-event { font-size:12px; border-radius:8px; padding:4px 6px; }

/* ===== 모달 ===== */
#holidayModal, #holidayModal_Annual {
  display:none; position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.4);
  justify-content:center; align-items:center;
  z-index:9999;
}
#holidayModal > div, #holidayModal_Annual > div {
  background:#fff; padding:24px; border-radius:14px;
  min-width:260px; text-align:center; z-index:9999;
}

/* ===== 상단 네비 ===== */
nav {
  width:100%; background-color:#ffffffb7; position:fixed;
  top:0; padding:0 auto; z-index:9999;
  backdrop-filter:blur(10px);
}
.titleNav { margin:0 auto; padding:0 24px; max-width:1100px; }
h1 { font-size:18px; text-align:left; }

/* ===== 레이아웃 ===== */
.panel { margin:0 auto; margin-top:60px; max-width:1100px; padding:24px; backdrop-filter:blur(10px); }
.flex { display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start; }
.left { min-width:370px; flex:1; }
.right { min-width:370px; flex:1; }

.left-item {
  display:flex; flex-direction:column;
  padding:20px; border-radius:12px;
  background:linear-gradient(180deg,#ffffff,#fbfcfe);
  box-shadow:0 4px 12px rgba(2,6,23,0.04);
  transition: transform .12s ease, box-shadow .12s ease;
}
.left-item:hover {
  transform:translateY(-4px);
  box-shadow:0 8px 22px rgba(2,6,23,0.08);
}

.right-item {
  display:flex; flex-direction:column;
  padding:20px; border-radius:12px;
  background:linear-gradient(180deg,#ffffff,#fbfcfe);
  align-items: flex-start;
  box-shadow:0 4px 12px rgba(2,6,23,0.04);
  transition: transform .12s ease, box-shadow .12s ease;
}
.right-item:hover {
  transform:translateY(-4px);
  box-shadow:0 8px 22px rgba(2,6,23,0.08);
}

/* ===== 입력 ===== */
#left-top-input-field {
  align-items: flex-start;    /* 윗 정렬 */
  display:flex; flex-direction:row; gap:12px;
}
#AnnualInput {
  width:50%;
  display:flex; flex-direction:column; gap:5px;
  justify-content:center;
}
#SubInput {
  width:50%;
  display:flex; flex-direction:column; gap:5px;
  justify-content:center;
}
input[type="date"], input[type="number"] {
  padding:8px 10px; border-radius:5px;
  border:1px solid #00000031;
}
.DataBtn { padding:8px 20px; font-weight: 500; font-size: 11px; box-shadow:0 4px 12px rgba(2,6,23,0.04); transition: transform .12s ease, box-shadow .12s ease;}
.DataBtn:hover { transform:translateY(-4px); box-shadow:0 8px 22px rgba(2,6,23,0.08); background:#c4c4c49f; }

/* ===== 리스트 ===== */
.list {
  max-height:340px; overflow-y:auto;
  border-radius:14px; background:#fbfbfd;
  padding:10px;
}
.item {
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 12px; margin-bottom:10px; border-radius:12px;
  background:linear-gradient(180deg,#ffffff,#fbfcfe);
  box-shadow:0 4px 12px rgba(2,6,23,0.04);
  transition: transform .12s ease, box-shadow .12s ease;
}
.item:hover { transform:translateY(-4px); box-shadow:0 8px 22px rgba(2,6,23,0.08); }
.item:last-child { margin-bottom:0; }

/* ===== 상태 ===== */
.status { margin-top:12px; font-weight:700; color:#0b1220; }
.status span { color:#007aff; }

/* ===== 기타 ===== */
#ManualBtn { right:2%; top:2%; position:fixed; z-index:9999; color:#0000008f; transition: transform .12s ease }
#ManualBtn:hover { transform:translateY(-2px); }
a {
  color: inherit;           /* 부모 글자색 따라가기 */
  text-decoration: none;    /* 밑줄 제거 */
  font-weight: 600;
}

/* ===== 공백 ===== */
.invisible-block {
  visibility: hidden;      /* 안 보임 + 자리 차지 */
  pointer-events: none;    /* 마우스 이벤트 막기 */
}

</style>
</head>
<body>
<!-- 상단 네비 -->
<nav>
  <div class="titleNav"><h1>휴가 계산기</h1></div>
</nav>

<!-- 매뉴얼 버튼 -->
<div id="ManualBtn">
  <label style="font-weight:600; font-size:12px;">
    <a href="https://github.com/CaMaGuee/home/blob/a3a774323692c2b9c66cb18a8c0c30cdef13604e/%ED%9C%B4%EA%B0%80%20%EA%B3%84%EC%82%B0%EA%B8%B0%20%EB%A9%94%EB%89%B4%EC%96%BC.pdf">사용 방법</a>
  </label>
</div>

<!-- 메인 패널 -->
<div class="panel flex">
  <!-- 왼쪽 -->
  <div class="left">
    <div class="left-item">
      <div id="left-top-input-field">
        <div id="AnnualInput">
          <label style="padding-left:3px;">연차 발생일</label>
          <input id="annDate" type="date">
          <label style="padding-left:3px;">일수</label>
          <input id="annDays" type="number" min="0.25" step="0.25" value="1">
          <button id="addAnn" class="primary">추가</button>
        </div>
        <div id="SubInput">
          <label style="padding-left:3px;">대체휴가 수동 입력</label>
          <input id="SubDateADD" type="date">
          <label class="invisible-block" style="padding-left:3px;">일수</label>
          <input class="invisible-block" type="number" min="0.25" step="0.25" value="1">
          <button id="addSub" class="primary">추가</button>
        </div>
      </div>
      <div id="left-top-btn" style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;"></div>
      <div id="left-top-save-load-btn">
        <button id="exportData" class="DataBtn small">내보내기</button>
        <input type="file" id="importFile" style="display:none;">
        <button id="importData" class="DataBtn small">불러오기</button>
      </div>
    </div>
    <br/>
    <div class="left-item">
      <div id="calendar" style="padding-bottom:15px;"></div>
    </div>
    <br/>
  </div>

  <!-- 오른쪽 -->
  <div class="right">
    <div class="right-item">
      <div class="status">남은 연차: <span id="remainingAnn">0</span> 일</div>
      <div class="status">남은 대체휴가: <span id="remainingSub">0</span> 일</div>
    </div>
    <br/>
    <div class="right-item">
      <div style="font-weight:700;margin-bottom:10px;">발생 연차 리스트</div>
      <div id="annList" class="list"></div>

      <div style="margin-top:16px; font-weight:700;">추가 대체휴가 리스트</div>
      <div id="addedSubList" class="list"></div>

      <div style="margin-top:16px; font-weight:700;">사용 휴가 리스트</div>
      <div id="usedList" class="list"></div>

      <div style="margin-top:16px; font-weight:700;">사용 대체휴가 리스트</div>
      <div id="usedSubList" class="list"></div>
    </div>
  </div>
</div>

<!-- 모달: 평일 선택 -->
<div id="holidayModal">
  <div>
    <div style="margin-bottom:12px; font-weight:600;">휴가를 추가하시겠습니까?</div>
    <div style="display:flex; gap:8px; justify-content:center;">
      <button id="modalAnnual" class="primary">연차</button>
      <button id="modalSub" class="primary">대체휴가</button>
      <button id="modalCancel" class="small">취소</button>
    </div>
  </div>
</div>

<!-- 모달: 연차 상세 선택 -->
<div id="holidayModal_Annual">
  <div>
    <div style="margin-bottom:12px; font-weight:600;">연차 선택</div>
    <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
      <button id="modalFull" class="primary">휴가(1일)</button>
      <button id="modalHalf" class="primary">휴가(0.5일)</button>
      <button id="modalQuarter" class="primary">휴가(0.25일)</button>
      <button id="modalAnnualCancel" class="small">취소</button>
    </div>
  </div>
</div>
    
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
let annIdCounter = 1;
const annualOccurrences = [];
let remainingAnn = 0;
const weekendSubHolidays = [];
const usedHolidays = [];
const usedSubHolidays = [];

let currentDate = '';
let currentWeekday = '';

function refreshLists(){
  const annList=document.getElementById('annList');
  const addedSubList=document.getElementById('addedSubList');
  annList.innerHTML='';
  annualOccurrences.slice().sort((a,b)=>a.date.localeCompare(b.date)).forEach(item=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `<div>${item.date} · 남은:${item.remaining}일</div>
                     <div><button class="small" onclick="deleteAnn(${item.id})">삭제</button></div>`;
    annList.appendChild(div);
  });

  addedSubList.innerHTML='';
  weekendSubHolidays.forEach((item, idx)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `<div>${item.date} (${item.weekday})</div>
                     <div><button class="small" onclick="deleteAddedSub(${idx})">삭제</button></div>`;
    addedSubList.appendChild(div);
  });

  const remainingSub = weekendSubHolidays.length - usedSubHolidays.length;
  document.getElementById('remainingAnn').innerText = remainingAnn.toFixed(2);
  document.getElementById('remainingSub').innerText = remainingSub;
}

function refreshUsedLists(){
  const usedList = document.getElementById('usedList');
  const usedSubList = document.getElementById('usedSubList');
  usedList.innerHTML='';
  usedSubList.innerHTML='';
  usedHolidays.forEach((item, idx)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML=`<div>${item.date} (${item.weekday}) - ${item.amount}일</div>
                   <div><button class="small" onclick="deleteUsedHoliday(${idx})">삭제</button></div>`;
    usedList.appendChild(div);
  });
  usedSubHolidays.forEach((item, idx)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML=`<div>${item.date} (${item.weekday})</div>
                   <div><button class="small" onclick="deleteUsedSub(${idx})">삭제</button></div>`;
    usedSubList.appendChild(div);
  });
}

function deleteAnn(id){ const idx = annualOccurrences.findIndex(a=>a.id===id); if(idx>=0){ remainingAnn -= annualOccurrences[idx].remaining; annualOccurrences.splice(idx,1); refreshLists(); }}
function deleteAddedSub(idx){ weekendSubHolidays.splice(idx,1); refreshLists(); }
function deleteUsedHoliday(idx){ remainingAnn += usedHolidays[idx].amount; usedHolidays.splice(idx,1); refreshUsedLists(); refreshLists(); }
function deleteUsedSub(idx){ usedSubHolidays.splice(idx,1); refreshUsedLists(); refreshLists(); }

document.getElementById('addAnn').onclick = () => {
  const date = document.getElementById('annDate').value;
  const days = Number(document.getElementById('annDays').value)||0;
  if(!date){ alert('날짜 입력'); return; }
  if(days<=0){ alert('0.25 이상'); return; }
  annualOccurrences.push({id: annIdCounter++, date, remaining: days});
  remainingAnn += days;
  refreshLists();
};

document.getElementById('addSub').onclick = () => {
  const dateStr = document.getElementById('SubDateADD').value;
  if(!dateStr){ alert('날짜를 선택하세요.'); return; }

  const dateObj = new Date(dateStr);                // 문자열을 Date로 변환
  const weekday = dateObj.toLocaleDateString('ko-KR',{weekday:'short'});
  const dayNum  = dateObj.getDay();                // 필요시 사용 (0:일요일,6:토요일)

  weekendSubHolidays.push({ date: dateStr, weekday });
  refreshLists();
}

/* ========== 내보내기 기능 (모든 데이터 저장) ========== */
document.getElementById('exportData').onclick = () => {
  const dataToSave = {
    annualOccurrences,
    weekendSubHolidays,
    usedHolidays,
    usedSubHolidays,
    annIdCounter,
    remainingAnn
  };
  const dataStr = JSON.stringify(dataToSave, null, 2);
  const blob = new Blob([dataStr], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='vacation_data.json';
  a.click();
  URL.revokeObjectURL(url);
};

/* ========== 불러오기 기능 (모든 데이터 복원) ========== */
document.getElementById('importData').onclick = () =>
  document.getElementById('importFile').click();

document.getElementById('importFile').addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload = event=>{
    try{
      const imported=JSON.parse(event.target.result);

      // 배열들 복원
      annualOccurrences.length = 0;
      imported.annualOccurrences?.forEach(v=>annualOccurrences.push(v));
      weekendSubHolidays.length = 0;
      imported.weekendSubHolidays?.forEach(v=>weekendSubHolidays.push(v));
      usedHolidays.length = 0;
      imported.usedHolidays?.forEach(v=>usedHolidays.push(v));
      usedSubHolidays.length = 0;
      imported.usedSubHolidays?.forEach(v=>usedSubHolidays.push(v));

      // 카운터, 잔여연차 복원
      annIdCounter = imported.annIdCounter ?? 1;
      remainingAnn = imported.remainingAnn ?? 0;

      // 새로 계산해서 표시
      refreshUsedLists();
      refreshLists();
      alert("불러오기 완료!");

    }catch(err){
      alert('파일 읽기 오류: '+err);
    }
  };
  reader.readAsText(file);
  e.target.value='';
});

document.addEventListener('DOMContentLoaded', ()=>{
  const calendarEl=document.getElementById('calendar');
  const calendar=new FullCalendar.Calendar(calendarEl,{
    initialView:'dayGridMonth', height:'auto',
    dateClick: info=>{
      currentDate = info.dateStr;
      currentWeekday = info.date.toLocaleDateString('ko-KR',{weekday:'short'});
      const dayNum = info.date.getDay();
      if(dayNum===0 || dayNum===6){ // 주말
        weekendSubHolidays.push({date:currentDate, weekday:currentWeekday});
        refreshLists();
      } else {
        document.getElementById('holidayModal').style.display='flex';
      }
    },
    dayMaxEvents:true
  });
  calendar.render();
});

// 모달 이벤트
document.getElementById('modalAnnual').onclick = () => {
    document.getElementById('holidayModal').style.display = 'none';
    const annualModal = document.getElementById('holidayModal_Annual');
    annualModal.style.display = 'flex';

    const addHoliday = (amount) => {
      remainingAnn -= amount;
      usedHolidays.push({date: currentDate, weekday: currentWeekday, amount});
      refreshUsedLists();
      refreshLists();
      annualModal.style.display = 'none';
    }

    document.getElementById('modalFull').onclick = () => addHoliday(1);
    document.getElementById('modalHalf').onclick = () => addHoliday(0.5);
    document.getElementById('modalQuarter').onclick = () => addHoliday(0.25);
    document.getElementById('modalAnnualCancel').onclick = () => annualModal.style.display = 'none';
}

document.getElementById('modalSub').onclick = ()=>{
    usedSubHolidays.push({date: currentDate, weekday: currentWeekday});
    refreshUsedLists();
    refreshLists();
    document.getElementById('holidayModal').style.display='none';
};

document.getElementById('modalCancel').onclick = ()=>document.getElementById('holidayModal').style.display='none';

// === 오늘 날짜를 모든 date input에 기본값으로 세팅 ===
document.querySelectorAll('input[type="date"]').forEach(el => {
  el.value = new Date().toISOString().split('T')[0];
});

</script>
</body>
</html>
