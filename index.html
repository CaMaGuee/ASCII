<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>휴가 계산기</title>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<style>
@font-face {
  font-family: 'NeoDGM';
  src: url('neodgm_code.woff') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

html, body{
  overflow: auto; /* 스크롤 가능 */
}

/* Chrome, Edge, Safari */
html::-webkit-scrollbar {
  width: 0px;
  background: transparent;
}

/* Firefox */
html {
  scrollbar-width: none; /* 스크롤바 숨김 */
  -ms-overflow-style: none; /* IE 10+ */
}

/* 전체 스타일: NeoDGM 우선 사용, 없으면 시스템 폰트 */
body {
  font-family: 'NeoDGM', "Noto Sans KR", sans-serif;
  margin: 0 auto;
  padding-left: 10%;
  padding-right: 10%;
  background: #e2e2e2;
  color: #111;
}

/* 헤더 */
h1 {
  text-align:center;
  margin-bottom:20px;
  font-weight:600;
  color:#002c5a;
}

/* 카드 패널 (애플 스타일) */
.panel {
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.88));
  border-radius: 18px;
  padding: 30px;
  box-shadow: 0 10px 10px rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
  margin-bottom: 20px;
}

/* 레이아웃 */
.flex { display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start; }
.left { flex:1; }
.right { width:380px; }

/* 리스트 카드 */
.list {
  max-height: 340px;
  overflow-y: auto;
  border-radius: 14px;
  background: #fbfbfd;
  padding: 10px;
}
.item {
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 12px; margin-bottom:10px; border-radius:12px;
  background: linear-gradient(180deg,#ffffff,#fbfcfe);
  box-shadow: 0 4px 12px rgba(2,6,23,0.04);
  transition: transform .12s ease, box-shadow .12s ease;
}
.item:hover { transform: translateY(-4px); box-shadow: 0 8px 22px rgba(2,6,23,0.08); }
.item:last-child { margin-bottom:0; }

/* 입력, 버튼 */
input[type="date"], input[type="number"] {
  padding:8px 10px; border-radius:5px; border:1px solid #00000031; margin-left:8px;
}
button {
  padding:8px 14px; border-radius:5px; border:none; cursor:pointer; font-weight:600;
}
button.primary { background:#268bffaf; color:#fff;}
button.primary:hover { background:#0f437e9f; color:#fff;}
button.small { background:#f1f3f6; color:#202124; }

/* 캘린더 박스 */
#calendar {
  margin-top:14px; border-radius:14px; overflow:hidden;
  box-shadow: 0 12px 30px rgba(2,6,23,0.06);
}

/* 상태 */
.status { margin-top:12px; font-weight:700; color:#0b1220; }
.status span { color:#007aff; }

/* FullCalendar 폰트 사이즈/패딩 조정 (좀 더 애플 느낌) */
.fc .fc-daygrid-day-number { font-size:13px; font-weight:600; padding:6px; color:rgb(87, 0, 0); }
.fc .fc-daygrid-event { font-size:12px; border-radius:8px; padding:4px 6px; }
</style>
</head>
<body>
  <h1>휴가 계산기</h1>

  <div class="panel flex">
    <div class="left">
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:12px;">
        <div><label style="padding:8px;">연차 발생일:</label><input id="annDate" type="date"></div>
        <div><label style="padding:8px;">일수:</label><input id="annDays" type="number" min="0.5" step="0.5" value="1" style="width:84px"></div>
        <button id="addAnn" class="primary">추가</button>
      </div>
      <div id="calendar"></div>
    </div>

    <div class="right">
      <div style="font-weight:700;margin-bottom:8px;">발생 연차 리스트</div>
      <div id="annList" class="list"></div>
      <div class="status">남은 연차: <span id="remainingAnn">0</span> 일</div>
      <div class="status">남은 대체휴가: <span id="remainingSub">0</span> 일</div>
      <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
          <button id="exportData" class="small">내보내기</button>
          <input type="file" id="importFile" style="display:none;">
          <button id="importData" class="small">불러오기</button>
        </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    let annIdCounter=1;
    const annualOccurrences=[];
    let remainingAnn=0, remainingSub=0;

    // 내보내기
    document.getElementById('exportData').onclick = () => {
      const dataStr = JSON.stringify(annualOccurrences, null, 2);
      const blob = new Blob([dataStr], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'annual_occurrences.json';
      a.click();
      URL.revokeObjectURL(url);
    };

    // 불러오기 버튼 클릭 -> 파일 선택
    document.getElementById('importData').onclick = () => {
      document.getElementById('importFile').click();
    };

    // 파일 선택 후 처리
    document.getElementById('importFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if(!file) return;

      const reader = new FileReader();
      reader.onload = event => {
        try {
          const imported = JSON.parse(event.target.result);
          if(Array.isArray(imported)){
            annualOccurrences.length = 0; // 기존 데이터 초기화
            remainingAnn = 0; remainingSub = 0;
            imported.forEach(item=>{
              // id 값 보존, 필요시 annIdCounter 갱신
              annualOccurrences.push({...item});
              remainingAnn += item.remaining;
              if(item.id >= annIdCounter) annIdCounter = item.id + 1;
            });
            refreshLists();
            alert('데이터 불러오기 완료');
          } else {
            alert('잘못된 파일입니다.');
          }
        } catch(err){
          alert('파일 읽기 오류: '+err);
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // 동일 파일 재선택 가능
    });

    function refreshLists(){
      const annList=document.getElementById('annList');
      annList.innerHTML='';
      annualOccurrences.slice().sort((a,b)=>a.date.localeCompare(b.date)).forEach(item=>{
        const div=document.createElement('div'); div.className='item';
        div.innerHTML = `<div>${item.date} · 남은:${item.remaining}일</div>
                         <div><button class="small" onclick="deleteAnn(${item.id})">삭제</button></div>`;
        annList.appendChild(div);
      });
      document.getElementById('remainingAnn').innerText = remainingAnn.toFixed(1);
      document.getElementById('remainingSub').innerText = remainingSub.toFixed(1);
    }

    function deleteAnn(id){
      const idx = annualOccurrences.findIndex(a=>a.id===id);
      if(idx>=0){
        remainingAnn -= annualOccurrences[idx].remaining;
        annualOccurrences.splice(idx,1);
        refreshLists();
      }
    }

    document.getElementById('addAnn').onclick = () => {
      const date = document.getElementById('annDate').value;
      const days = Number(document.getElementById('annDays').value)||0;
      if(!date){ alert('날짜 입력'); return; }
      if(days<=0){ alert('0.5 이상'); return; }
      annualOccurrences.push({id: annIdCounter++, date, remaining: days});
      remainingAnn += days;
      refreshLists();
    };

    document.addEventListener('DOMContentLoaded', ()=>{
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        dateClick: info => {
          const d = info.dateStr;
          if(confirm(`${d} 날짜 사용: 연차 -1, 대체휴가 -1?`)){
            remainingAnn -= 1;
            remainingSub -= 1;
            refreshLists();
          }
        },
        // (선택) 이벤트 스타일 조정 가능
        dayMaxEvents: true
      });
      calendar.render();
    });

    
  </script>
</body>
</html>
